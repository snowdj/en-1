<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Cheng-Jun Wang" />
    <title>Fitting rank order distribution with R | Cheng-Jun Wang</title>
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="http://chengjun.github.io/en/feed/" rel="alternate" title="Cheng-Jun Wang" type="application/atom+xml" />
    <link rel="stylesheet" href="/media/css/style.css">
    <link rel="stylesheet" href="/media/css/highlight.css">
    <script type="text/javascript" src="/media/js/jquery-1.7.1.min.js"></script>
    <!--highlight.js Start-->
    <link rel="stylesheet" title="Default" href="/media/js/styles/tomorrow-night-blue.css">
    <script type="text/javascript" src="/media/js/highlight.pack.js"></script>
    <script>
    hljs.configure({tabReplace: '    '});
    hljs.initHighlightingOnLoad();
    </script>
    <!--highlight.js End-->
    <!--mathjax start-->
    <script type="text/javascript"
            src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
    <!--mathjax end-->
  </head>
  <body>
    <div id="container">
      <div id="main" role="main">
        <header>
        <h1>Fitting rank order distribution with R</h1>
        </header>
        <nav>
		<!-- Sidebar -->
        <h5 id="logo" style="text-align:center;">
        <a href="http://chengjun.github.io/" target="_blank">
			<img src="/cv/images/chengjun.jpg" width="100" class="with_border"/>
        </a><a href="http://chengjun.github.io/">Cheng-Jun Wang</a></h5>
		<span><a title="About me" class="" href="http://chengjun.github.io/">about</a></span>
        <span><a title="blog page" class="" href="http://chengjun.github.io/en/">blog</a></span>
        <span><a title="cv" class="" href="http://chengjun.github.io/cv/">cv</a></span>
        <span><a title="categories" class="" href="http://chengjun.github.io/en/categories/">categories</a></span>
        <span><a title="tags" class="" href="http://chengjun.github.io/en/tags/">tags</a></span>
        <span><a title="links" class="" href="http://chengjun.github.io/en/links/">links</a></span>
        <span><a title="subscribe by RSS" class="" href="http://chengjun.github.io/en/feed/">subscribe</a></span>
        </nav>
        <article class="content">
        <section class="post">
<p>The long-tail distribution can be quantified in primarily <a href="http://arxiv.org/pdf/cond-mat/0412004.pdf?origin=publication_detail">three ways, see Newman &#8216;s paper here</a>: </p>

<ul>
  <li>Power law distribution</li>
  <li>Zipf distribution</li>
  <li>Pareto distribution</li>
</ul>

<p>Here, I talk about the Zipf distribution which assesses the relationship between rank order and Frequency (probability). </p>

<blockquote>
  <p>Zipf&#8217;s law now refers more generally to frequency distributions of &#8220;rank data,&#8221; in which the relative frequency of the nth-ranked item is given by the Zeta distribution. from <a href="http://en.wikipedia.org/wiki/Zipf's_law">Wikipedia</a> </p>
</blockquote>

<h2 id="dgbd">DGBD</h2>

<p>In Gustavo Martínez-Mekler et al&#8217;s <a href="http://www.plosone.org/article/info%3adoi/10.1371/journal.pone.0004791">article</a>, they proposed a discrete generalized beta distribution: <script type="math/tex">f(r) = A(N+1-r)^b/r^a</script>, where r is the rank, <strong>N</strong> is maximum value, A the normalization constant and (a, b) two fitting exponents.</p>

<p>It&#8217;s interesting to find that <a href="http://journals.aps.org/pre/pdf/10.1103/PhysRevE.84.026113">Wu and Zhang (2011)</a> adopt the DGBD distribution to quantify the online social systems. Basically, they are interested in accelerating growth in human online behaviors. </p>

<p>Deﬁning P as the number of active users in a day and T as the total activity generated by these users, they find a power law relationship between them <script type="math/tex">T = P^\gamma</script>. Given <script type="math/tex">\gamma</script> larger than 1, there exists an accelerating growth phenomena in online systems (e.g., tagging, microblogging)</p>

<p>They denote the activity of a user in one day with t(r), in which r is the decreasing rank of the activity among all individual activities in the day. Thus the maximum value of r, <script type="math/tex">r_{max}</script>, equals population P. The DGBD model of individual activities is then</p>

<script type="math/tex; mode=display">t(r) = A(P+1−r)^b r^a (a > 0,b > 0)</script>

<p>They introduced that a determines the activities of highly active users(corresponds to the exponent <script type="math/tex">\alpha</script> in Zipf’s law), b determines the activities of the less active users. Using the DGBD, They can ﬁt the empirical curves with <script type="math/tex">R^2</script> &gt; 0.9. </p>

<p>Here I start with an empirical dataset. The Tweet of Milan city in December 2013. Basically, we know the language of each tweet. Thus we have the frequency of each language. </p>

<pre><code>freq = c(1116, 2067, 137 ,  124, 643,  2042, 55  ,47186,  7504, 1488, 211,   1608,  3517 , 7  , 896  ,  378, 17 ,3098, 164977  ,  601 ,  196, 637, 149 , 44,2 ,  1801, 882   , 636,5184,  1851,  776 ,   343   , 851, 33  ,4011,   209,  715 ,  937 , 20,   6922, 2028 , 23,  3045 , 16 , 334,  31 ,  2)

lan = c("af","ar","bg","cs","da","de","el","en","es","et","fa","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","mk","ne","nl","no","pl","pt","ro","ru","sk","sl","so","sq","sv","sw","th","tl","tr","uk","und","ur","vi","zh-cn","zh-tw")
</code></pre>

<p>Thus, we can calculate the decreasing rank for each language. </p>

<pre><code>Rank = rank(-freq, ties.method = c("first") )
data = data.frame(lan, freq, Rank)
data$Probability = data$Freq/sum(data$Freq)
</code></pre>

<p>We can write a simple function to fit the rank ordered data and capture the distribution. </p>

<pre><code>get_dgbd = function(freq){
  Rank = rank(-freq, ties.method = c("first") )
  p = freq/sum(as.numeric(freq))
  # get the log form
  log.f = log(freq)
  log.p = log(p)
  log.rank = log(Rank)
  log.inverse.rank = log(length(Rank)+1-Rank)
  
  # linear regression of zifp: for probability
  cozp=coef(lm(log.p~log.rank))
  zipf.p = function(x) exp(cozp[[1]] + cozp[2]*log(x))
  
  # linear regression of zifp: for frequency
  cozf=coef(lm(log.f~log.rank))
  zipf.f = function(x) exp(cozf[[1]] + cozf[2]*log(x)) 
  
  # linear regression of dgbd: for probability
  codp=coef(lm(log.p~log.inverse.rank + log.rank))
  dgbd.p = function(x) exp(codp[[1]]+ codp[[2]]*log(length(x)+1-x) + codp[[3]]*log(x))
  
  # linear regression of dgbd: for frequency
  codf=coef(lm(log.f~log.inverse.rank + log.rank))
  dgbd.f = function(x) exp(codf[[1]]+ codf[[2]]*log(length(x)+1-x) + codf[[3]]*log(x))
  return(c(zipf.p, zipf.f, dgbd.p, dgbd.f))
}

zipf.p = get_dgbd(data$Freq)[[1]]
zipf.f = get_dgbd(data$Freq)[[2]]
dgbd.p = get_dgbd(data$Freq)[[3]]
dgbd.f = get_dgbd(data$Freq)[[4]]


plot(freq~Rank,log="xy", xlab = "Rank (log)", ylab = "Frequency (log)", data = data)
curve(zipf.f, col="red", add = T, n = length(data$Rank))
curve(dgbd.f, col="blue", add = T, n = length(data$Rank))
</code></pre>

<p>Remember to specify the length of values in &#8216;curve&#8217;. About its importance, check <a href="http://stackoverflow.com/questions/22446006/why-is-curve-so-different-from-lines-and-points-in-r">this post</a> on stackoverflow. </p>

<p>Finally, we can plot it with ggplot2. </p>

<pre><code>require(ggplot2)
P = ggplot(data=data, aes(x=Rank, y=Freq, label = Var1)) + geom_point() + 
  coord_trans(xtrans = "log10", ytrans = "log10")+
  stat_function(fun = dgbd.f, n = length(Rank), colour = 'red', size = 1)+
  geom_text(aes(label=Var1),hjust=1.5, vjust=0, angle = 45, size = 3)

png(file = "./language_rank_order_distribution2.png", 
    width=8, height=5, 
    units="in", res=700)
P 
dev.off()
</code></pre>

<p><img src="http://farm3.staticflickr.com/2725/13212714535_820edf5a12_z.jpg" alt="" /></p>

<p><img src="http://farm3.staticflickr.com/2767/13213038184_4d8fb106d2_z.jpg" alt="" /></p>

<h2 id="how-to-construct-your-model">How to construct your model?</h2>

<p>Using the DGBD model, we can fit the frequency-rank data almost perfectly. However, there are many other other forms of alternative equations. For example, there are Zipf-Manderbrot Model and <a href="http://statweb.stanford.edu/~owen/courses/306a/ZipfAndGutenberg.pdf">its modifications</a>, How to guarantee that which specific model is the right one? We need to:</p>

<ul>
  <li>learn more about the underlying mechanisms. </li>
  <li>observe the patterns of the data</li>
</ul>

<p>In the paper titled <a href="http://www3.nd.edu/~networks/Publication%20Categories/03%20Journal%20Articles/Social%20Science/Modeling%20bursts_Phys.%20Rev.%20E%2073,%20036127%20(2006).pdf">Modeling bursts and heavy tails in human dynamics</a>, Alexei Vázquez et al tried to propose two queuing models to explain the <strong>value</strong> of scaling parameter in the temporal patterns of human behaviors. They capture the temporal patterns with two measurements: interevent time <script type="math/tex">\tau</script> and waiting times <script type="math/tex">\tau_{w}</script>.</p>

<p>The time between two consecutive events is called the interevent time, <script type="math/tex">\tau</script>; the waiting (or response) time, <script type="math/tex">\tau_w</script>, representing the amount of time a task waits on an individual’s priority list before being executed.</p>

<p>Assuming that <strong>the tasks are executed independently from each other at a constant rate <script type="math/tex">\lambda</script></strong>, the time can be approximated by a Poisson process: </p>

<p><script type="math/tex">p(\tau) = \lambda e^{-\lambda \tau}</script> . </p>

<p>However, we know that in many human behaviors, the Poisson process fails to capture the burst phenomenon. The temporal patterns can be generally categorized into two classes:</p>

<ul>
  <li>
    <p>A. The <script type="math/tex">\alpha</script>= 1 universality class: Web browsing, email, and library datasets</p>
  </li>
  <li>
    <p>B. The <script type="math/tex">\alpha</script>=3/2 universality class: The correspondence of Einstein, Darwin, and Freud, which is characterized by <strong>a power law decay</strong> combined with <strong>an exponential cutoff</strong>.</p>
  </li>
</ul>

<p><script type="math/tex">p(\tau)\simeq \tau^{-3/2} e^{-\tau / \tau_{0}}</script>. </p>

<p>in which <script type="math/tex">\tau_0 = \frac{1}{\mu (1-\sqrt{\rho})}</script>, and <script type="math/tex">\rho = \lambda / \mu</script>. Recall that <script type="math/tex">\lambda</script> is the arrival rate of new task, and <script type="math/tex">\mu</script> is the response rate , thus <script type="math/tex">\rho</script> is the task/job/traffic intensity. </p>

<ul>
  <li>Subcritical regime: When <script type="math/tex">\rho</script> &lt; 1, there are fewer job, and more queuing space. </li>
  <li>Critical regime: When <script type="math/tex">\rho</script> = 1, arrival rate equals response rate</li>
  <li>Supercritical regime: When <script type="math/tex">\rho</script> &gt; 1, there are more job, and less queuing space. </li>
</ul>

<p>However, they also find that the interevent time distribution between two consecutive transactions made by a stock broker. The distribution follows a power law with the exponential cutoff <script type="math/tex">p(\tau)\simeq \tau^{-1.3} e^{-\tau / \tau_{0}}</script>. </p>

<h4 id="references">References</h4>

<p>Martínez-Mekler G, Martínez RA, del Río MB, Mansilla R, Miramontes P, et al. (2009) Universality of Rank-Ordering Distributions in the Arts and Sciences. PLoS ONE 4(3): e4791. doi:10.1371/journal.pone.0004791</p>

<p>Wu L, Zhang J. (2011) Accelerating growth and size-dependent distribution of human online activities. PHYSICAL REVIEW E 84, 026113 (2011)</p>

</section>
<section class="meta">
<span class="author">
  <a href="http://chengjun.github.io/en">Cheng-Jun Wang</a>
</span>
<span class="time">
  /
  <time datetime="2014-03-17">2014-03-17</time>
</span>
<br />
<span class="license">
  Published under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">(CC) BY-NC-SA</a>
</span>

<span class="categories">
  in categories
  
  <a href="http://chengjun.github.io/en/categories/#r" title="r">r</a>&nbsp;
  
</span>


<span class="tags">
  tagged with 
  
  <a href="http://chengjun.github.io/en/tags/#power law" title="power law">power law</a>&nbsp;
  
  <a href="http://chengjun.github.io/en/tags/#distribution" title="distribution">distribution</a>&nbsp;
  
</span>

</section>
<section class="comment">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname ='ChengjunWANG'; // required: replace example with your forum shortname
    var disqus_url = 'http://chengjun.github.io/en/2014/03/fit-power-law/';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</section>


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    if (e.target.nodeName.toUpperCase() != 'BODY') return;
    var url = false;
        if (e.which == 37 || e.which == 74) {  // Left arrow and J
            
        url = 'http://chengjun.github.io/en/2014/03/scraping-weibo-using-python/';
        
        }
        else if (e.which == 39 || e.which == 75) {  // Right arrow and K
            
        url = 'http://chengjun.github.io/en/2014/04/vison-statement/';
        
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>


        </article>
      </div>
    </div>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', '']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
